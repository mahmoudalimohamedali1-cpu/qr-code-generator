<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DashCord - QR Code Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            padding: 40px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            gap: 15px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .logo-icon {
            width: 70px;
            height: 70px;
            position: relative;
            flex-shrink: 0;
        }

        .logo-icon svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .logo-text {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5a8a 40%, #4a7ba7 60%, #ff8c42 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
            position: relative;
            text-transform: none;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        .logo-underline {
            height: 4px;
            background: linear-gradient(90deg, #ff8c42, #ff6b1a);
            width: 100px;
            margin: 2px 0 0 0;
            border-radius: 2px;
            box-shadow: 0 2px 4px rgba(255, 140, 66, 0.3);
        }

        h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 12px;
            text-align: center;
            margin-top: 20px;
        }

        .description {
            color: #666;
            text-align: center;
            margin-bottom: 32px;
            font-size: 16px;
            line-height: 1.5;
        }

        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 8px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 32px;
        }

        button {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #f5f5f5;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 24px;
            display: none;
            text-align: center;
            font-weight: 500;
        }

        .success-message.show {
            display: block;
        }

        .qr-section {
            margin-top: 40px;
            padding-top: 40px;
            border-top: 2px solid #e0e0e0;
            display: none;
        }

        .qr-section.show {
            display: block;
        }

        .qr-placeholder {
            text-align: center;
            color: #999;
            padding: 40px;
            font-style: italic;
        }

        .qr-heading {
            color: #333;
            font-size: 24px;
            margin-bottom: 16px;
            text-align: center;
        }

        .qr-container {
            display: flex;
            justify-content: center;
            margin-bottom: 16px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        #qrcode {
            display: flex;
            justify-content: center;
        }

        #qrcode canvas {
            border-radius: 8px;
        }

        .qr-instruction {
            text-align: center;
            color: #666;
            margin-bottom: 24px;
            font-size: 14px;
        }

        .qr-actions {
            display: flex;
            gap: 12px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 1000;
            font-size: 14px;
        }

        .toast.show {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        @media (max-width: 600px) {
            .container {
                padding: 24px;
            }

            .logo-container {
                flex-direction: column;
                gap: 10px;
                margin-bottom: 20px;
            }

            .logo-icon {
                width: 50px;
                height: 50px;
            }

            .logo-text {
                font-size: 28px;
            }

            .logo-underline {
                width: 80px;
            }

            h1 {
                font-size: 24px;
            }

            .button-group,
            .qr-actions {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-container">
            <div class="logo-icon">
                <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="dGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#1e3a5f;stop-opacity:1" />
                            <stop offset="30%" style="stop-color:#2d5a8a;stop-opacity:1" />
                            <stop offset="70%" style="stop-color:#4a7ba7;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#ff8c42;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="wingGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#1e3a5f;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#2d5a8a;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#4a7ba7;stop-opacity:1" />
                        </linearGradient>
                        <filter id="shadow">
                            <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.2"/>
                        </filter>
                    </defs>
                    <!-- Wing shape (behind D) -->
                    <path d="M 25 60 Q 15 50 8 40 Q 3 32 8 25 Q 12 18 25 25 L 25 30 Q 15 28 10 32 Q 8 35 10 38 Q 12 42 18 45" 
                          fill="url(#wingGradient)" 
                          stroke="#1e3a5f" 
                          stroke-width="2"
                          filter="url(#shadow)"/>
                    <!-- D Shape outline -->
                    <path d="M 25 25 L 25 95 L 60 95 Q 85 95 85 60 Q 85 25 60 25 Z" 
                          fill="url(#dGradient)" 
                          stroke="#1e3a5f" 
                          stroke-width="2.5"
                          filter="url(#shadow)"/>
                    <!-- Arrow inside D -->
                    <path d="M 40 60 L 70 60 M 65 55 L 70 60 L 65 65" 
                          stroke="#ff8c42" 
                          stroke-width="4" 
                          stroke-linecap="round" 
                          stroke-linejoin="round" 
                          fill="none"/>
                    <!-- Chain links/beads at bottom of wing -->
                    <circle cx="15" cy="30" r="2.5" fill="#4a7ba7" opacity="0.9"/>
                    <circle cx="18" cy="35" r="2.5" fill="#4a7ba7" opacity="0.9"/>
                    <circle cx="15" cy="40" r="2.5" fill="#4a7ba7" opacity="0.9"/>
                    <circle cx="12" cy="35" r="2" fill="#2d5a8a" opacity="0.7"/>
                </svg>
            </div>
            <div>
                <div class="logo-text">DashCord</div>
                <div class="logo-underline"></div>
            </div>
        </div>
        <h1>QR Code Generator</h1>
        <p class="description">Fill in the fields below, then tap Done to generate a QR code.</p>

        <div class="success-message" id="successMessage">Your QR code is ready.</div>

        <form id="qrForm">
            <div class="form-group">
                <label for="title">Title</label>
                <input type="text" id="title" name="title" placeholder="Enter a title (optional)">
            </div>

            <div class="form-group">
                <label for="urlOrData">URL or Data <span style="color: #e74c3c;">*</span></label>
                <textarea id="urlOrData" name="urlOrData" placeholder="Enter the URL or data to encode" required></textarea>
                <div class="error-message" id="urlError">Please enter some data to encode.</div>
            </div>

            <div class="form-group">
                <label for="note">Note</label>
                <input type="text" id="note" name="note" placeholder="Enter a note (optional)">
            </div>

            <div class="button-group">
                <button type="submit" class="btn-primary">Done</button>
                <button type="button" class="btn-secondary" id="clearBtn">Clear</button>
            </div>
        </form>

        <div class="qr-section" id="qrSection">
            <h2 class="qr-heading">Your QR Code</h2>
            <div class="qr-container">
                <div id="qrcode"></div>
            </div>
            <p class="qr-instruction">Scan this QR code to open the data.</p>
            <div class="qr-actions">
                <button type="button" class="btn-secondary" id="downloadBtn">Download</button>
                <button type="button" class="btn-secondary" id="copyBtn">Copy Data</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">Copied to clipboard</div>

    <script>
        let currentQrData = '';
        let qrCodeInstance = null;

        // Wait for QRCode library to load
        function waitForQRCode(callback, maxAttempts = 50) {
            if (typeof QRCode !== 'undefined') {
                console.log('QRCode library loaded');
                callback();
            } else if (maxAttempts > 0) {
                setTimeout(() => waitForQRCode(callback, maxAttempts - 1), 100);
            } else {
                console.error('QRCode library failed to load');
                alert('QR Code library failed to load. Please refresh the page.');
            }
        }

        // Generate QR code from form data
        function generateQrFromForm() {
            console.log('generateQrFromForm called');
            const urlOrData = document.getElementById('urlOrData').value.trim();
            const errorMessage = document.getElementById('urlError');
            const successMessage = document.getElementById('successMessage');
            const qrSection = document.getElementById('qrSection');
            const qrContainer = document.getElementById('qrcode');

            // Clear previous error
            errorMessage.classList.remove('show');

            // Validate required field
            if (!urlOrData) {
                console.log('Validation failed: URL/Data is empty');
                errorMessage.classList.add('show');
                return;
            }

            console.log('Validation passed, generating QR code...');

            // Get form values
            const title = document.getElementById('title').value.trim();
            const note = document.getElementById('note').value.trim();

            // Build the combined string
            let combinedData = '';
            if (title) {
                combinedData += `Title: ${title}\n`;
            }
            combinedData += `URL/Data: ${urlOrData}\n`;
            if (note) {
                combinedData += `Note: ${note}`;
            }

            // Remove trailing newline if present
            combinedData = combinedData.trim();

            // Store the data for copying
            currentQrData = combinedData;

            // Clear previous QR code
            qrContainer.innerHTML = '';
            qrCodeInstance = null;

            // Wait for library to be ready, then generate QR code
            waitForQRCode(function() {
                console.log('QRCode library is ready, starting generation...');
                console.log('Data to encode:', combinedData);
                
                try {
                    // Use qrcodejs library API
                    qrCodeInstance = new QRCode(qrContainer, {
                        text: combinedData,
                        width: 256,
                        height: 256,
                        colorDark: '#000000',
                        colorLight: '#FFFFFF',
                        correctLevel: QRCode.CorrectLevel.M
                    });

                    console.log('QR code generated successfully');
                    
                    // Show success message and QR section
                    successMessage.classList.add('show');
                    qrSection.classList.add('show');

                    // Scroll to QR code section
                    setTimeout(() => {
                        qrSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 100);
                } catch (err) {
                    console.error('Exception generating QR code:', err);
                    qrContainer.innerHTML = '<p style="color: red; text-align: center; padding: 20px;">Error: ' + err.message + '</p>';
                    alert('Error: ' + err.message);
                }
            });
        }

        // Clear form and QR code
        function clearFormAndQr() {
            document.getElementById('qrForm').reset();
            document.getElementById('urlError').classList.remove('show');
            document.getElementById('successMessage').classList.remove('show');
            document.getElementById('qrSection').classList.remove('show');
            document.getElementById('qrcode').innerHTML = '';
            currentQrData = '';
            qrCodeInstance = null;
        }

        // Download QR code as PNG
        function downloadQrImage() {
            const qrContainer = document.getElementById('qrcode');
            const canvas = qrContainer.querySelector('canvas');
            const img = qrContainer.querySelector('img');
            
            let dataUrl = '';
            
            if (canvas) {
                dataUrl = canvas.toDataURL('image/png');
            } else if (img && img.src) {
                dataUrl = img.src;
            } else {
                alert('No QR code to download');
                return;
            }

            // Create download link
            const link = document.createElement('a');
            link.download = 'qr-code.png';
            link.href = dataUrl;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Copy QR data to clipboard
        async function copyQrData() {
            if (!currentQrData) {
                return;
            }

            try {
                await navigator.clipboard.writeText(currentQrData);
                showToast();
            } catch (err) {
                console.error('Failed to copy:', err);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = currentQrData;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToast();
                } catch (fallbackErr) {
                    console.error('Fallback copy failed:', fallbackErr);
                    alert('Failed to copy to clipboard');
                }
                document.body.removeChild(textArea);
            }
        }

        // Show toast notification
        function showToast() {
            const toast = document.getElementById('toast');
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // Event listeners - wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('qrForm').addEventListener('submit', function(e) {
                e.preventDefault();
                generateQrFromForm();
            });

            document.getElementById('clearBtn').addEventListener('click', clearFormAndQr);
            document.getElementById('downloadBtn').addEventListener('click', downloadQrImage);
            document.getElementById('copyBtn').addEventListener('click', copyQrData);
        });
    </script>
</body>
</html>
